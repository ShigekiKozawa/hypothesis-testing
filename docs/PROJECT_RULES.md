# プロジェクトルール (Project Rules)

この文書は、Grade 3 の問題生成と運用に関する最も新しいルールセットです。Gemini プロンプト・UI 表示・監査スクリプトのいずれにおいても、ここに記された内容を起点として判断します。

## 1. Grade 3 の出題範囲
- 記述統計（平均・中央値・分散・標準偏差・変動係数・偏差値・標準化など）
- グラフ読取（ヒストグラム、箱ひげ図、幹葉図、散布図、棒グラフ、度数分布表）
- 相関と単回帰分析（相関係数、決定係数、残差、予測値、回帰直線）
- 確率・分布（基本確率、二項分布の計算、標本分布、中心極限定理の理解）
- 推測統計の基礎（標本平均の期待値・分散、標準誤差、信頼区間・仮説検定の解釈）
- 実験計画と標本調査（無作為化、対応のあるデータ、クロス集計表の読解）
- データ変換（1次変換、標準化）や外れ値の理解

## 2. Grade 3 で絶対に出題しない項目
以下のテーマは Grade 3 の模擬試験・リファレンス・プロンプトのいずれにも含めません：
- 不偏分散（n-1 で割る式等）や母集団・標本の定義を掘り下げる概念問題
- Type I/II エラーや検出力（power）に関連する計算・意味
- t検定・F検定（分布・t/F 値・具体的な計算）
- カイ二乗検定（カテゴリカルデータ同士の独立性検出）
- 多重比較（Bonferroni・Holm など）の具体的処理
- 偏相関係数・部分相関（同時に複数変数の調整を扱う内容）
- 重回帰分析、分散分析（ANOVA）の詳細な計算
- 概念のみを問う問題（定義・用語訳だけ）の出題

## 3. 問題形式とチャートの取り扱い
- 問題は「表・グラフ読取」と「計算・データ加工」のいずれかに収める。概念問題は禁止。
- グラフ・表が不要な問題には `chartType` / `barData` / `chartLabels` などチャート関連を含めない。
- チャートを表示する場合、`question` に「下の」「次の」「以下の」等の明示的な参照語を含め、軸ラベルは実データ（例：`勉強時間(時間)`、`テスト得点(点)`）を使う。
- 背景グラフ（Category/Value）を出力しない。実データがないグラフは作らない。
- 選択肢の数値は既約分数に統一し、重複しないようにする。

## 4. 生成・監査フロー
- `src/utils/geminiClient.ts` のプロンプトには必ず本ルールと `.cursor/rules/ai-question-rules.mdc` を参照する文言を含める。
- 問題生成後は `scripts/checkAndFixAnswers.js` を実行し、`correct` のインデックスと `explanation` の整合性を確認。
- 問題を修正したら `npm run build` を実行して型チェック・ビルドの破壊がないか確認。
- ルールを変更した場合はこのファイルに反映し、`.cursor/rules/ai-question-rules.mdc` も合わせて更新する。

## 5. 関連ドキュメント
- `.cursor/rules/ai-question-rules.mdc`：プロンプトで必ず参照する禁止項目・図表ルール + 全体の統一ルール。
- `docs/HOW_TO_GENERATE_QUESTIONS.md`：Gemini に渡す実際のプロンプト構造と確認ポイント。
- `docs/README.md`：ドキュメント全体の索引と運用メモ。

## 6. 更新履歴
- 2025-12：docs ディレクトリに整理。プロンプト・UI・スクリプトで最新ルールを共有する体制を再構築。

